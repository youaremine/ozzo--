(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3da355a4"],{"01b9":function(e,t,a){"use strict";a("0513")},"0513":function(e,t,a){},"741a":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"divBox"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"container"},[a("el-form",{attrs:{inline:"",size:"small","label-width":"120px"}},[a("el-form-item",{attrs:{label:"標籤名稱："}},[a("el-input",{staticClass:"selWidth",attrs:{placeholder:"請輸入標籤名稱"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(1)}},model:{value:e.tableFrom.keyword,callback:function(t){e.$set(e.tableFrom,"keyword",t)},expression:"tableFrom.keyword"}},[a("el-button",{staticClass:"el-button-solt",attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.getList(1)}},slot:"append"})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"標籤類型："}},[a("el-select",{staticClass:"filter-item selWidth mr20",attrs:{placeholder:"請選擇",clearable:""},on:{change:function(t){return e.getList(1)}},model:{value:e.tableFrom.type,callback:function(t){e.$set(e.tableFrom,"type",t)},expression:"tableFrom.type"}},e._l(e.labelTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onAdd}},[e._v("設置自動標籤")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData.data,size:"small","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"ID",prop:"label_rule_id","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"標籤名稱",prop:"label.label_name","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"標籤類型","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(0===t.row.type?"訂單數":"訂單金額"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"標籤規則","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return["0.00"===t.row.min&&"0.00"===t.row.max?a("span",[e._v("從未支付的客戶")]):a("span",[1===t.row.type?a("span",[e._v("訂單金額在"+e._s(t.row.min)+" - "+e._s(t.row.max)+"的客戶")]):a("span",[e._v("支付訂單數在"+e._s(Math.trunc(t.row.min))+" - "+e._s(Math.trunc(t.row.max))+"的客戶")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"客戶數",prop:"user_num","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"更新時間","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.update_time?t.row.update_time:"未更新"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"100",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.onUpdate(t.row.label_rule_id)}}},[e._v("更新")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.onEdit(t.row)}}},[e._v("編輯")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDelete(t.row.label_rule_id,t.$index)}}},[e._v("刪除")])]}}])})],1),e._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"page-sizes":[20,40,60,80],"page-size":e.tableFrom.limit,"current-page":e.tableFrom.page,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.total},on:{"size-change":e.handleSizeChange,"current-change":e.pageChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"900px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.fullscreenLoading,expression:"fullscreenLoading"}],ref:"formValidate",staticClass:"formValidate mt20",attrs:{model:e.formValidate,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"標籤類型："}},[a("el-radio-group",{on:{change:e.initCount},model:{value:e.formValidate.type,callback:function(t){e.$set(e.formValidate,"type",t)},expression:"formValidate.type"}},[a("el-radio",{attrs:{label:0}},[e._v("訂單次數標籤")]),e._v(" "),a("el-radio",{attrs:{label:1}},[e._v("訂單金額標籤")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"標籤名稱："}},[a("el-input",{attrs:{placeholder:"請輸入標籤名稱"},model:{value:e.formValidate.label_name,callback:function(t){e.$set(e.formValidate,"label_name",t)},expression:"formValidate.label_name"}})],1),e._v(" "),1===e.formValidate.type?a("el-form-item",{attrs:{label:"消費金額設置："}},[a("el-input",{staticClass:"number_input",attrs:{type:"number",min:1},model:{value:e.formValidate.min,callback:function(t){e.$set(e.formValidate,"min",t)},expression:"formValidate.min"}}),e._v("港幣\n        "),a("span",[e._v("-")]),e._v(" "),a("el-input",{staticClass:"number_input",staticStyle:{"margin-left":"10px"},attrs:{type:"number",min:e.formValidate.min},model:{value:e.formValidate.max,callback:function(t){e.$set(e.formValidate,"max",t)},expression:"formValidate.max"}}),e._v("港幣\n      ")],1):a("el-form-item",{attrs:{label:"消費次數設置："}},[a("el-input",{staticClass:"number_input",attrs:{type:"number",value:Math.trunc(e.formValidate.min),min:1},nativeOn:{keyup:function(t){return e.number(t)}},model:{value:e.formValidate.min,callback:function(t){e.$set(e.formValidate,"min",e._n(t))},expression:"formValidate.min"}}),e._v("次\n        "),a("span",[e._v("-")]),e._v(" "),a("el-input",{staticClass:"number_input",staticStyle:{"margin-left":"10px"},attrs:{type:"number",min:e.formValidate.min},nativeOn:{keyup:function(t){return e.number(t)}},model:{value:e.formValidate.max,callback:function(t){e.$set(e.formValidate,"max",e._n(t))},expression:"formValidate.max"}}),e._v("次\n      ")],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"30px"}},[a("el-button",{staticClass:"submission",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("提交")])],1)],1)],1)],1)},i=[],n=(a("96cf"),a("1da1")),r=(a("84b4"),a("6b54"),a("a481"),a("c24f")),s={name:"UserGroup",data:function(){return{tableFrom:{page:1,limit:20,type:"",keyword:""},labelTypeList:[{label:"訂單次數",value:0},{label:"訂單金額",value:1}],tableData:{data:[],total:0},formValidate:{type:0,label_name:"",min:"",max:""},listLoading:!0,dialogVisible:!1,fullscreenLoading:!1,title:"添加標籤",label_id:""}},mounted:function(){this.getList("")},methods:{number:function(){this.formValidate.min=this.formValidate.min.toString().replace(/[^\.\d]/g,""),this.formValidate.min=this.formValidate.min.toString().replace(".",""),this.formValidate.max=this.formValidate.max.toString().replace(/[^\.\d]/g,""),this.formValidate.max=this.formValidate.max.toString().replace(".","")},initCount:function(){this.formValidate.min=this.formValidate.max=""},getList:function(e){var t=this;this.listLoading=!0,this.tableFrom.page=e||this.tableFrom.page,Object(r["c"])(this.tableFrom).then((function(e){t.tableData.data=e.data.list,t.tableData.total=e.data.count,console.log(t.tableData),t.listLoading=!1})).catch((function(e){t.listLoading=!1,t.$message.error(e.message)}))},pageChange:function(e){this.tableFrom.page=e,this.getList("")},handleSizeChange:function(e){this.tableFrom.limit=e,this.getList("")},onAdd:function(){this.dialogVisible=!0,this.title="添加標籤",this.label_id="",this.formValidate={type:0,label_name:"",min:"",max:""}},onEdit:function(e){this.dialogVisible=!0,this.title="編輯標籤",this.label_id=e.label_rule_id,this.formValidate={type:e.type,label_name:e.label&&e.label.label_name?e.label.label_name:"",min:1===e.type?e.min:Math.trunc(e.min),max:1===e.type?e.max:Math.trunc(e.max)}},onUpdate:function(e){var t=this;Object(r["d"])(e).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$message.success(a.message);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$message.error(e.message)}))},handleDelete:function(e,t){var a=this;this.$modalSure().then((function(){Object(r["b"])(e).then((function(e){var l=e.message;a.$message.success(l),a.tableData.data.splice(t,1)})).catch((function(e){var t=e.message;a.$message.error(t)}))}))},handleSubmit:function(e){var t=this;this.label_id?Object(r["e"])(this.label_id,this.formValidate).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.fullscreenLoading=!1,t.$message.success(a.message),t.dialogVisible=!1,t.getList("");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.fullscreenLoading=!1,t.$message.error(e.message)})):Object(r["a"])(this.formValidate).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.fullscreenLoading=!1,t.$message.success(a.message),t.dialogVisible=!1,t.getList("");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.fullscreenLoading=!1,t.$message.error(e.message)}))}}},o=s,m=(a("01b9"),a("2877")),c=Object(m["a"])(o,l,i,!1,null,"4da36ea5",null);t["default"]=c.exports},"84b4":function(e,t,a){var l=a("5ca1");l(l.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})}}]);